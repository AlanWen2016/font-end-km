<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JWT认证 | 搬砖日记</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.3276c1c2.css" as="style"><link rel="preload" href="/assets/js/app.1abae75d.js" as="script"><link rel="preload" href="/assets/js/2.a02d7939.js" as="script"><link rel="preload" href="/assets/js/22.8f1be9d4.js" as="script"><link rel="prefetch" href="/assets/js/10.b04b700e.js"><link rel="prefetch" href="/assets/js/11.a758c2aa.js"><link rel="prefetch" href="/assets/js/12.2340907b.js"><link rel="prefetch" href="/assets/js/13.1bf9b835.js"><link rel="prefetch" href="/assets/js/14.c3d3e1c0.js"><link rel="prefetch" href="/assets/js/15.663ec4c5.js"><link rel="prefetch" href="/assets/js/16.41799076.js"><link rel="prefetch" href="/assets/js/17.d1d49adf.js"><link rel="prefetch" href="/assets/js/18.9ba4cc2e.js"><link rel="prefetch" href="/assets/js/19.431611a8.js"><link rel="prefetch" href="/assets/js/20.4b97c433.js"><link rel="prefetch" href="/assets/js/21.dc828843.js"><link rel="prefetch" href="/assets/js/23.59875430.js"><link rel="prefetch" href="/assets/js/24.18e977e0.js"><link rel="prefetch" href="/assets/js/25.29a9c78a.js"><link rel="prefetch" href="/assets/js/26.48e7b5ea.js"><link rel="prefetch" href="/assets/js/27.aea7950c.js"><link rel="prefetch" href="/assets/js/28.76d3791e.js"><link rel="prefetch" href="/assets/js/29.f7db5f41.js"><link rel="prefetch" href="/assets/js/3.61b48f38.js"><link rel="prefetch" href="/assets/js/30.d1f8d600.js"><link rel="prefetch" href="/assets/js/31.d230d333.js"><link rel="prefetch" href="/assets/js/32.9187b39d.js"><link rel="prefetch" href="/assets/js/33.18a73aef.js"><link rel="prefetch" href="/assets/js/34.32538372.js"><link rel="prefetch" href="/assets/js/35.38c54295.js"><link rel="prefetch" href="/assets/js/36.61c875fe.js"><link rel="prefetch" href="/assets/js/37.2afc0eb3.js"><link rel="prefetch" href="/assets/js/38.22c84c1e.js"><link rel="prefetch" href="/assets/js/4.76807e14.js"><link rel="prefetch" href="/assets/js/5.4f6e0848.js"><link rel="prefetch" href="/assets/js/6.cd88fdfe.js"><link rel="prefetch" href="/assets/js/7.7fe6793a.js"><link rel="prefetch" href="/assets/js/8.0d7dcd78.js"><link rel="prefetch" href="/assets/js/9.4c01e5bd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3276c1c2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">搬砖日记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">大纲</a></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">大纲</a></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JavaScript基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/javascript/basic.html" class="sidebar-link">变量和类型</a></li><li><a href="/guide/javascript/prototype.html" class="sidebar-link">原型和原型链</a></li><li><a href="/guide/javascript/closure.html" class="sidebar-link">闭包</a></li><li><a href="/guide/javascript/npm.html" class="sidebar-link">npm发布</a></li><li><a href="/guide/javascript/module.html" class="sidebar-link">模块化</a></li><li><a href="/guide/javascript/jwt.html" class="active sidebar-link">JSON WEB令牌</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>HTML</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/html/test.html" class="sidebar-link">HMLT</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CSS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/css/gradient.html" class="sidebar-link">渐变</a></li><li><a href="/guide/css/flex.html" class="sidebar-link">flex布局</a></li><li><a href="/guide/css/animation.html" class="sidebar-link">css动画</a></li><li><a href="/guide/css/layout.html" class="sidebar-link">css布局</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>VUE</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/vue/jsx.html" class="sidebar-link">render函数和jsx</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Docker</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/docker/docker.html" class="sidebar-link">Docker基础</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Jenkins</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/jenkins/jenkins.html" class="sidebar-link">jenkin</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/webpack/webpack.html" class="sidebar-link">webpack</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="jwt认证"><a href="#jwt认证" aria-hidden="true" class="header-anchor">#</a> JWT认证</h1> <p>JSON WEB令牌，目前比较流行的跨域解决方案,开放标准(RFC 7519),使用JSON对象进行数据传递，通过签名进行信息验证。</p> <h3 id="常规认证流程和存在问题"><a href="#常规认证流程和存在问题" aria-hidden="true" class="header-anchor">#</a> 常规认证流程和存在问题</h3> <p>用户使用账号密码登陆后，服务端在当前会话（session）储存用户信息，并向客户端返回session_id存入cookie。随后的每个请求，cookie都会带上这个session_id想服务端进行验证，已确定用户的身份。
这种方案在集群和跨域的站点，就需要实现session共享、是每台服务器都能读取到这个session。把session写的redis或者db可以解决这个问题。</p> <h3 id="实现方案、安全问题"><a href="#实现方案、安全问题" aria-hidden="true" class="header-anchor">#</a> 实现方案、安全问题</h3> <p>用户登陆到服务端后，服务端返回给客户端一个JSON对象。JWT对象分为三部分：</p> <ul><li>Header（头部）</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
  &quot;alg&quot;: &quot;HS256&quot;,
  &quot;typ&quot;: &quot;JWT&quot;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>Payload（负载）</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>iss (issuer)：签发人
exp (expiration time)：过期时间
sub (subject)：主题
aud (audience)：受众
nbf (Not Before)：生效时间
iat (Issued At)：签发时间
jti (JWT ID)：编号
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>Signature（签名）</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>HMACSHA256(
  base64UrlEncode(header) + &quot;.&quot; +
  base64UrlEncode(payload),
  secret)

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>算出签名以后，把 Header、Payload、Signature 三个部分拼成一个字符串，每个部分之间用&quot;点&quot;（.）分隔，就可以返回给用户。</p> <div class="tip custom-block"><p>验签算法实现方案</p></div> <div class="language-php line-numbers-mode"><pre class="language-php"><code>// php实现
<span class="token php language-php"><span class="token delimiter important">&lt;?</span>php<span class="token operator">&gt;</span>
    

<span class="token operator">&lt;</span><span class="token operator">/</span>php<span class="token operator">&gt;</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 使用express实现</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="缺点："><a href="#缺点：" aria-hidden="true" class="header-anchor">#</a> 缺点：</h3> <p>第四条是JWT 的最大缺点是，由于服务器不保存 session 状态，因此无法在使用过程中废止某个token，或者更改 token的权限。也就是说，一旦JWT 签发了，在到期之前就会始终有效，除非服务器部署额外的逻辑</p> <p>因为jwt一般会放在redis或者mysql表，只要逻辑上去找到uid对应的jwt，删了就可以了。</p> <blockquote><p>相关知识： 单点登陆</p></blockquote> <p>单点登录（Single Sign On），简称为 SSO，SSO的定义是在多个应用系统中，用户只需要登录一次就可以访问所有相互信任的应用系统。
单点登陆实现方案：共享cookie、通过JSONP、页面重定向、独立的登陆系统。实现方法可以参考这篇文章<a href="https://yq.aliyun.com/articles/636281" target="_blank" rel="noopener noreferrer">单点登录（SSO）看这一篇就够了<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。<br>
一个单点登陆系统流程可以参考如下：</p> <ol><li>判断当前app应用是否登陆</li> <li>若无登录，则跳转到登陆系统进行登陆</li> <li>登陆完成，登陆系统生成一个Service Ticket,并跳转回app，写入登陆系统的Cookie。（这个cookie属于登陆系统域的，完成这个即代表用户已经通过单点登陆系统的认证）</li> <li>当前app拿着这个sService Ticket去后台进行验证。（后台需要向登陆系统发送请求验证Service Ticket是否有效）</li> <li>验证通过，则当前app可以种下自己的Cookie</li></ol> <p><a href="http://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html" target="_blank" rel="noopener noreferrer">JSON Web Token 入门教程 - 阮一峰<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href=""></a> <a href=""></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/guide/javascript/module.html" class="prev">
          模块化
        </a></span> <span class="next"><a href="/guide/html/test.html">
          HMLT
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1abae75d.js" defer></script><script src="/assets/js/2.a02d7939.js" defer></script><script src="/assets/js/22.8f1be9d4.js" defer></script>
  </body>
</html>
