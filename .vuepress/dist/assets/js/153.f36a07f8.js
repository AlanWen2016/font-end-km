(window.webpackJsonp=window.webpackJsonp||[]).push([[153],{383:function(t,s,a){"use strict";a.r(s);var e=a(0),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"浏览器的回流与重绘"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#浏览器的回流与重绘"}},[t._v("#")]),t._v(" 浏览器的回流与重绘")]),t._v(" "),a("blockquote",[a("p",[t._v("浏览器回流与重绘的底层原理，引发原因，如何有效避免")])]),t._v(" "),a("p",[t._v("浏览器的渲染流程：")]),t._v(" "),a("ul",[a("li",[t._v("1.解析HTML，生成DOM树，解析CSS，生成CSSOM树")]),t._v(" "),a("li",[t._v("2.将DOM树和CSSOM树结合，生成渲染树(Render Tree)")]),t._v(" "),a("li",[t._v("3.Layout(回流):根据生成的渲染树，进行回流(Layout)，得到节点的几何信息（位置，大小）")]),t._v(" "),a("li",[t._v("4.Painting(重绘):根据渲染树以及回流得到的几何信息，得到节点的绝对像素")]),t._v(" "),a("li",[t._v("5.Display:将像素发送给GPU，展示在页面上。（这一步其实还有很多内容，比如会在GPU将多个合成层合并为同一个层，并展示在页面中。而css3硬件加速的原理则是新建合成层")])]),t._v(" "),a("h3",{attrs:{id:"什么是回流，什么是重绘？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是回流，什么是重绘？"}},[t._v("#")]),t._v(" 什么是回流，什么是重绘？")]),t._v(" "),a("p",[t._v("回流： reflow, 跟DOM元素的几何属性相关。当DOM元素当几何尺寸发生改变，例如元素的宽、高，隐藏元素时，浏览器需要重新计算元素的几何属性，然后将结果绘制出来，这个过程叫回流，也叫重排")]),t._v(" "),a("p",[t._v("重绘： repaint, DOM元素属性被修改，但是没有改变元素的几何属性，比如说只是改变了元素背景颜色，浏览器不需要重新计算元素的几何属性，直接为该元素绘制样式，这个过程叫重绘。")]),t._v(" "),a("p",[t._v("回流过程一定会导致回流，重绘和回流都是比较消耗性能的，性能优化就是需要减少重绘和回流的次数。")]),t._v(" "),a("h3",{attrs:{id:"哪些操作会导致重绘和回流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#哪些操作会导致重绘和回流"}},[t._v("#")]),t._v(" 哪些操作会导致重绘和回流")]),t._v(" "),a("p",[t._v("导致重绘的操作比较容易识别：\n不影响元素的几何尺寸，修改元素是颜色、背景色、可见性（visibility）")]),t._v(" "),a("p",[t._v("导致回流的操作：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("改变元素的几何属性\n先看元素的几何属性，常见的几何属性：width、height、padding、margin、left、top、border")])]),t._v(" "),a("li",[a("p",[t._v("改变dom树结构\n这里主要是只元素节点的增减和移动，浏览器引擎布局的过程，顺序上可以类比于树的前序遍历——它是一个从上到下、从左到右的过程。通常在这个过程中，当前元素不会再影响其前面已经遍历过的元素。\n当你要用到像这样的属性：")]),t._v(" "),a("ul",[a("li",[t._v("offsetTop、offsetLeft、offsetWidth、offsetHeight")]),t._v(" "),a("li",[t._v("scrollTop、scrollLeft、scrollWidth、scrollHeight")]),t._v(" "),a("li",[t._v("clientTop、clientLeft、clientWidth、clientHeight")]),t._v(" "),a("li",[t._v("getComputedStyle()")]),t._v(" "),a("li",[t._v("getBoundingClientRect")]),t._v(" "),a("li",[t._v("具体可以访问这个网站：https://gist.github.com/paulirish/5d52fb081b3570c81e3a")])])]),t._v(" "),a("li",[a("p",[t._v("调用了 getComputedStyle 方法，或者 IE 里的 currentStyle 时，也会触发回流")])])]),t._v(" "),a("h3",{attrs:{id:"如何减少重绘和回流操作？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何减少重绘和回流操作？"}},[t._v("#")]),t._v(" 如何减少重绘和回流操作？")]),t._v(" "),a("ul",[a("li",[t._v("合并属性操作")]),t._v(" "),a("li",[t._v("避免逐条改变样式，使用类名去合并样式")]),t._v(" "),a("li",[t._v("DOM 离线化： 一旦我们给元素设置 display: none，将其从页面上“拿掉”，那么我们的后续操作，将无法触发回流与重绘——这个将元素“拿掉”的操作，就叫做 DOM 离线化。")])]),t._v(" "),a("h4",{attrs:{id:"最小化重绘和重排"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#最小化重绘和重排"}},[t._v("#")]),t._v(" 最小化重绘和重排")]),t._v(" "),a("ul",[a("li",[a("ul",[a("li",[t._v("使用cssText")])])])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" el "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cssText "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'border-left: 1px; border-right: 2px; padding: 5px;'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("ul",[a("li",[a("ul",[a("li",[t._v("修改CSS的class")])])])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" el "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("className "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("' active'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("h4",{attrs:{id:"批量修改dom"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#批量修改dom"}},[t._v("#")]),t._v(" 批量修改DOM")]),t._v(" "),a("ul",[a("li",[t._v("使元素脱离文档流")]),t._v(" "),a("li",[t._v("对其进行多次修改")]),t._v(" "),a("li",[t._v("将元素带回到文档中。")])]),t._v(" "),a("h4",{attrs:{id:"css3硬件加速（gpu加速）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#css3硬件加速（gpu加速）"}},[t._v("#")]),t._v(" css3硬件加速（GPU加速）")]),t._v(" "),a("p",[t._v("划重点：使用css3硬件加速，可以让transform、opacity、filters这些动画不会引起回流重绘 。但是对于动画的其它属性，比如background-color这些，还是会引起回流重绘的，不过它还是可以提升这些动画的性能。")]),t._v(" "),a("ul",[a("li",[t._v("transform")]),t._v(" "),a("li",[t._v("opacity")]),t._v(" "),a("li",[t._v("filters")]),t._v(" "),a("li",[t._v("Will-change")])]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("参考资料：")]),t._v(" "),a("ol",[a("li",[a("a",{attrs:{href:"https://github.com/chenjigeng/blog/issues/4",target:"_blank",rel:"noopener noreferrer"}},[t._v("你真的了解回流和重绘吗"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=n.exports}}]);